<style>
	.image_picker_image {
		width: 60px;
		height: 60px;
	}
</style>

<div class="row">
	<div class="col-md-12">
		<h3 class="page-header">商品详情</h3>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading">
		<button id="btnSave" type="button" class="btn btn-success">保存</button>
		<button type="button" class="btn btn-info" onclick="window.location.href='${rc.contextPath}/goods/list.html'">返回</button>
	</div>
	<div class="panel-body">
		<form class="form-horizontal" id="editForm">
			<fieldset>
				<legend>基本信息</legend>
				<div class="form-group">
					<label class="col-sm-2 control-label">SKU</label>
					<p class="col-sm-4 form-control-static">$!{form.goods.sku}</p>
					<input id="sku" name="sku" type="hidden" value="$!{form.goods.sku}">
					<label class="col-sm-2 control-label">商品编码</label>
					<p class="col-sm-4 form-control-static">$!{form.goods.parentSku}</p>
					<input name="parentSku" type="hidden" value="$!{form.goods.parentSku}">
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">商品名称</label>
					<div class="col-sm-4">
						<input name="name" class="form-control" value="$!{form.goods.name}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">是否多款式</label>
					<div class="col-sm-4">
						<select name="isMoreSytle" class="form-control">
							<option value="">请选择</option>
							<option value="True" #if($!{form.goods.isMoreSytle}=='True' ) selected#end>True</option>
							<option value="False" #if($!{form.goods.isMoreSytle}=='False' ) selected#end>False</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">是否停售</label>
					<div class="col-sm-4">
						<select name="state" class="form-control">
							<option value="">请选择</option>
							<option value="True" #if($!{form.goods.state}=='True' ) selected#end>True</option>
							<option value="False" #if($!{form.goods.state}=='False' ) selected#end>False</option>
						</select>
					</div>
					<label class="col-sm-2 control-label">是否带电</label>
					<div class="col-sm-4">
						<select name="isElectric" class="form-control">
							<option value="">请选择</option>
							<option value="True" #if($!{form.goods.isElectric}=='True' ) selected#end>True</option>
							<option value="False" #if($!{form.goods.isElectric}=='False' ) selected#end>False</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">是否有样品</label>
					<div class="col-sm-4">
						<select name="hasSample" class="form-control">
							<option value="">请选择</option>
							<option value="True" #if($!{form.goods.hasSample}=='True' ) selected#end>True</option>
							<option value="False" #if($!{form.goods.hasSample}=='False' ) selected#end>False</option>
						</select>
					</div>
					<label class="col-sm-2 control-label">样品数量</label>
					<div class="col-sm-4">
						<input name="sampleNum" class="form-control" value="$!{form.goods.sampleNum}" digits="true" maxlength="6">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">大类名称</label>
					<div class="col-sm-4">
						<input name="bigCataName" class="form-control" value="$!{form.goods.bigCataName}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">小类名称</label>
					<div class="col-sm-4">
						<input name="smallCataName" class="form-control" value="$!{form.goods.smallCataName}" maxlength="20">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">所有库存数量</label>
					<div class="col-sm-4">
						<input name="allNum" class="form-control" value="$!{form.goods.allNum}" digits="true" maxlength="7">
					</div>
					<label class="col-sm-2 control-label">重量（G）</label>
					<div class="col-sm-4">
						<input name="weight" class="form-control" value="$!{form.goods.weight}" number="true" maxlength="7" required>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">成本单件（元）</label>
					<div class="col-sm-4">
						<input name="costPrice" class="form-control" value="$!{form.goods.costPrice}" number="true" maxlength="7" required>
					</div>
					<label class="col-sm-2 control-label">批发价格（美元）</label>
					<div class="col-sm-4">
						<input name="batchPrice" class="form-control" value="$!{form.goods.batchPrice}" number="true" maxlength="7">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">中文申报名</label>
					<div class="col-sm-4">
						<input name="reportNameCn" class="form-control" value="$!{form.goods.reportNameCn}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">英文申报名</label>
					<div class="col-sm-4">
						<input name="reportNameEn" class="form-control" value="$!{form.goods.reportNameEn}" maxlength="20">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">申报价值（美元）</label>
					<div class="col-sm-4">
						<input name="reportPrice" class="form-control" value="$!{form.goods.reportPrice}" number="true" maxlength="7">
					</div>
					<label class="col-sm-2 control-label">开发日期</label>
					<div class="col-sm-4">
						<input name="bussDate" class="form-control" value="$!{form.goods.bussDate}" dateISO="true">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">原产国代码</label>
					<div class="col-sm-4">
						<input name="prodCountryCd" class="form-control" value="$!{form.goods.prodCountryCd}" maxlength="10">
					</div>
					<label class="col-sm-2 control-label">原产国</label>
					<div class="col-sm-4">
						<input name="prodCountryName" class="form-control" value="$!{form.goods.prodCountryName}" maxlength="20">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">业绩归属人1</label>
					<div class="col-sm-4">
						<input name="bussOwner1" class="form-control" value="$!{form.goods.bussOwner1}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">业绩归属人2</label>
					<div class="col-sm-4">
						<input name="bussOwner2" class="form-control" value="$!{form.goods.bussOwner2}" maxlength="20">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">采购员</label>
					<div class="col-sm-4">
						<input name="buyer" class="form-control" value="$!{form.goods.buyer}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">采购到货天数</label>
					<div class="col-sm-4">
						<input name="buyDayNum" class="form-control" value="$!{form.goods.buyDayNum}" digits="true" maxlength="3">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">供应商1</label>
					<div class="col-sm-10">
						<input name="url" class="form-control" value="$!{form.goods.url}" url="true">
					</div>

				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">供应商2</label>
					<div class="col-sm-10">
						<input name="url2" class="form-control" value="$!{form.goods.url2}" url="true">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">供应商3</label>
					<div class="col-sm-10">
						<input name="url3" class="form-control" value="$!{form.goods.url3}" url="true">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">商品英文标题</label>
					<div class="col-sm-10">
						<input name="title" class="form-control" value="$!{form.goodsPlat.title}" maxlength="200">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">标签</label>
					<div class="col-sm-10">
						<input name="tags" class="form-control" value="$!{form.goodsPlat.tags}">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">颜色</label>
					<div class="col-sm-4">
						<input name="color" class="form-control" value="$!{form.goodsPlat.color}" maxlength="20">
					</div>
					<label class="col-sm-2 control-label">尺寸</label>
					<div class="col-sm-4">
						<input name="size" class="form-control" value="$!{form.goodsPlat.size}" maxlength="20">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">平台库存</label>
					<div class="col-sm-4">
						<input name="quantity" class="form-control" value="$!{form.goodsPlat.quantity}" digits="true" maxlength="6">
					</div>
					<label class="col-sm-2 control-label">运送时效</label>
					<div class="col-sm-4">
						<input name="shipDays" class="form-control" value="$!{form.goodsPlat.shipDays}" maxlength="10">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">创建时间</label>
					<p class="col-sm-4 form-control-static">$!{form.goods.createTm}</p>
					<input name="createTm" type="hidden" value="$!{form.goods.createTm}">
					<label class="col-sm-2 control-label">更新时间</label>
					<p class="col-sm-4 form-control-static">$!{form.goods.modifyTm}</p>
					<input name="modifyTm" type="hidden" value="$!{form.goods.modifyTm}">
				</div>
			</fieldset>

			<fieldset>
				<legend>图片信息</legend>
				<div class="form-group">
					<label class="col-sm-2 control-label">Listing主图</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.mainImgUrl}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU主图</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.vMainImgUrl}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
						<button type="button" class="btn btn-info btn-sm" data-toggle='modal' data-target='#mainImgModal'>设置主图</button>
					</div>
				</div>


				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图1</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU附图2</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl1}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图3</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl2}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU附图4</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl3}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图5</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl4}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU附图6</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl5}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图7</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl6}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU附图8</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl7}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图9</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl8}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label">SKU附图10</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl9}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">SKU附图11</label>
					<div class="col-sm-4">
						<img height="40px" width="40px" src="http://www.bentain.site/$!{form.goodsImg.eImgUrl10}" />
						<button type="button" class="btn btn-info btn-sm" onclick="">上传图片</button>
					</div>
					<label class="col-sm-2 control-label"></label>
					<div class="col-sm-4">
					</div>
				</div>

			</fieldset>

			<fieldset>
				<legend>产品描述</legend>
				<div class="form-group">
					<div class="col-sm-12">
						<textarea name="descp" class="form-control" rows="10">$!{form.goodsPlat.descp}</textarea>
					</div>
				</div>
			</fieldset>

		</form>
	</div>
</div>

<!-- mainImg Modal-->
<div id="mainImgModal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">设置主图</h4>
			</div>
			<div class="modal-body">
				<form id="mainImgForm">
					<div class="form-group">
						<label>请从已有图片中选择主图</label>
						<select id="mainImgSelect" class="image-picker show-html">
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.mainImgUrl}" value="mainImgUrl">mainImgUrl</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.vMainImgUrl}" value="vMainImgUrl" selected>vMainImgUrl</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl}" value="eImgUrl">eImgUrl</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl1}" value="eImgUrl1">eImgUrl1</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl2}" value="eImgUrl2">eImgUrl2</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl3}" value="eImgUrl3">eImgUrl3</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl4}" value="eImgUrl4">eImgUrl4</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl5}" value="eImgUrl5">eImgUrl5</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl6}" value="eImgUrl6">eImgUrl6</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl7}" value="eImgUrl7">eImgUrl7</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl8}" value="eImgUrl8">eImgUrl8</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl9}" value="eImgUrl9">eImgUrl9</option>
						  <option data-img-src="http://www.bentain.site/$!{form.goodsImg.eImgUrl10}" value="eImgUrl10">eImgUrl10</option>
						</select>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="confirm-yes btn btn-primary" id="btnMainImg">提交</button>
				<button type="button" class="confirm-no btn btn-danger" data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>

<script>

	$().ready(function () {
		 $("#mainImgSelect").imagepicker({
          hide_select : true,
          show_label  : false
        });
		
		$("img").on("error",function(){
        	 $(this).hide();
			 $(this).after('<button type="button" class="btn btn-info btn-sm" onclick="javascript:reget(this);">重新抓取</button>') 
      	});
	});
	
	
	function reget(obj) {
		var img = $(obj).prev();
		var imgSrc = $(img).attr("src");
		imgSrc = imgSrc.replace("http://www.bentain.site/", "");
		imgSrc = imgSrc.replace(".jpg", "");
		var index = imgSrc.lastIndexOf("-");
		var sku = $("#sku").val();
		var imgName = imgSrc.substring(index+1);
		$.ajax({
			cache: true,
			type: "POST",
			url: "${rc.contextPath}/goods/reget.html",
			data: { sku: sku, imgName: imgName },
			async: false,
			error: function (request) {
				base.alert("操作失败!");
			},
			success: function (data) {
				base.alert("尝试重新获取，请稍后刷新！");
			}
		});
	}
	
	$("#btnMainImg").on("click", function () {
		var sku = $("#sku").val();
		var imgName = $("#mainImgSelect option[selected]").val(); 
		$.ajax({
			cache: true,
			type: "POST",
			url: "${rc.contextPath}/goods/setmain.html",
			data: { sku: sku, imgName: imgName },
			async: false,
			error: function (request) {
				base.alert("操作失败!");
			},
			success: function (data) {
				$("#mainImgModal").modal('hide')
            	window.location.reload();
			}
		});
	})

	

</script>